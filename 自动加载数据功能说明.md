# 自动加载数据功能说明

## 功能概述
现在用户打开前端界面后，系统会自动加载预置的Excel数据，无需手动上传文件即可查看流量数据和竞争对手数据。

## 实现方案

### 后端修改 (server.js)

1. **添加全局数据存储**
   ```javascript
   // 全局变量存储数据
   let globalTrafficData = [];
   let globalCompetitorData = [];
   ```

2. **创建数据加载函数**
   - `loadTrafficData()`: 加载流量数据
   - `loadCompetitorData()`: 加载竞争对手数据

3. **启动时自动加载**
   ```javascript
   const initializeData = async () => {
     console.log('正在初始化数据...');
     
     // 加载流量数据
     globalTrafficData = loadTrafficData();
     
     // 加载竞争对手数据
     globalCompetitorData = loadCompetitorData();
     
     console.log('数据初始化完成！');
     console.log(`流量数据: ${globalTrafficData.length} 条`);
     console.log(`竞争对手数据: ${globalCompetitorData.length} 条`);
   };
   ```

4. **简化API响应**
   - `/api/load-excel`: 直接返回 `globalTrafficData`
   - `/api/competitor-matching`: 直接返回 `globalCompetitorData`

### 前端修改 (src/App.jsx)

1. **页面加载时自动获取数据**
   ```javascript
   useEffect(() => {
     // 总是尝试从服务器加载最新数据
     loadInitialData();
     loadCompetitorData();
   }, []);
   ```

2. **移除本地存储依赖**
   - 不再依赖 `localStorage` 中的缓存数据
   - 每次页面加载都从服务器获取最新数据

## 数据文件要求

### 必需文件
1. **`网站流量数据.xlsx`** - 放在后端根目录
2. **`流量前一百竞争对手匹配.xlsx`** - 放在后端根目录

### 文件结构
- 流量数据文件应包含：公司、域名、九月访问量、八月访问量、购买转化率、平均访问时长等列
- 竞争对手匹配文件应包含两个Sheet：
  - Sheet1: 公司、竞争对手等列
  - Sheet2: 公司、投资机构等列

## 部署步骤

### 1. 上传Excel文件到Railway
将以下文件上传到Railway后端根目录：
- `网站流量数据.xlsx`
- `流量前一百竞争对手匹配.xlsx`

### 2. 重新部署后端
- 推送修改后的 `server.js` 到GitHub
- Railway会自动重新部署

### 3. 重新部署前端
- 推送修改后的 `src/App.jsx` 到GitHub
- Vercel会自动重新部署

## 预期效果

### 用户体验
1. **打开页面即显示数据** - 无需手动上传文件
2. **数据实时更新** - 每次刷新页面都获取最新数据
3. **保持原有功能** - 上传功能仍然可用，用于更新数据

### 后端日志
启动时会显示：
```
正在初始化数据...
成功加载 771 条流量数据
成功加载 100 条竞争对手数据
数据初始化完成！
流量数据: 771 条
竞争对手数据: 100 条
```

## 注意事项

1. **文件路径** - 确保Excel文件在Railway后端的根目录
2. **文件格式** - 确保Excel文件格式正确，列名匹配
3. **错误处理** - 如果文件不存在，系统会记录日志但不会崩溃
4. **性能** - 数据在启动时加载一次，后续API调用直接从内存返回

## 故障排除

### 如果数据没有自动加载
1. 检查Railway后端日志，确认Excel文件是否存在
2. 检查文件路径是否正确
3. 检查Excel文件格式是否正确

### 如果前端显示空白
1. 检查Vercel前端部署是否成功
2. 检查网络连接，确认能访问Railway API
3. 检查浏览器控制台是否有错误信息
